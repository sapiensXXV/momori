FROM openjdk:21-jdk as builder
WORKDIR /backend

ARG JAR_PATH=momori-0.1-SNAPSHOT.jar
COPY ${JAR_PATH} app.jar

ARG OAUTH2_GITHUB_CLIENT_ID
ARG OAUTH2_GITHUB_CLIENT_SECRET_ID
ARG OAUTH2_NAVER_CLIENT_ID
ARG OAUTH2_NAVER_CLIENT_SECRET_ID
ARG OAUTH2_KAKAO_CLIENT_ID
ARG OAUTH2_KAKAO_CLIENT_SECRET_ID
ARG OAUTH2_DISCORD_CLIENT_ID
ARG OAUTH2_DISCORD_CLIENT_SECRET_ID
ARG MYSQL_MASTER_DB_HOST
ARG MYSQL_USERNAME
ARG MYSQL_PASSWORD
ARG MONGODB_HOST
ARG MONGODB_DATABASE
ARG OAUTH2_JWT_SECRET_KEY

ARG S3_REGION
ARG S3_BUCKET_NAME
ARG AWS_IAM_ACCESS_KEY
ARG AWS_IAM_SECRET_KEY

ARG REDIS_HOST
ARG REDIS_PORT
ARG REDIS_USERNAME
ARG REDIS_PASSWORD

ENV OAUTH2_GITHUB_CLIENT_ID=${OAUTH2_GITHUB_CLIENT_ID}
ENV OAUTH2_GITHUB_CLIENT_SECRET_ID=${OAUTH2_GITHUB_CLIENT_SECRET_ID}
ENV OAUTH2_NAVER_CLIENT_ID=${OAUTH2_NAVER_CLIENT_ID}
ENV OAUTH2_NAVER_CLIENT_SECRET_ID=${OAUTH2_NAVER_CLIENT_SECRET_ID}
ENV OAUTH2_KAKAO_CLIENT_ID=${OAUTH2_KAKAO_CLIENT_ID}
ENV OAUTH2_KAKAO_CLIENT_SECRET_ID=${OAUTH2_KAKAO_CLIENT_SECRET_ID}
ENV OAUTH2_DISCORD_CLIENT_ID=${OAUTH2_DISCORD_CLIENT_ID}
ENV OAUTH2_DISCORD_CLIENT_SECRET_ID=${OAUTH2_DISCORD_CLIENT_SECRET_ID}
ENV MYSQL_MASTER_DB_HOST=${MYSQL_MASTER_DB_HOST}
ENV MYSQL_USERNAME=${MYSQL_USERNAME}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}
ENV MONGODB_HOST=${MONGODB_HOST}
ENV MONGODB_DATABASE=${MONGODB_DATABASE}
ENV OAUTH2_JWT_SECRET_KEY=${OAUTH2_JWT_SECRET_KEY}
ENV S3_REGION=${S3_REGION}
ENV S3_BUCKET_NAME=${S3_BUCKET_NAME}
ENV AWS_IAM_ACCESS_KEY=${AWS_IAM_ACCESS_KEY}
ENV AWS_IAM_SECRET_KEY=${AWS_IAM_SECRET_KEY}
ENV REDIS_HOST=${REDIS_HOST}
ENV REDIS_PORT=${REDIS_PORT}
ENV REDIS_USERNAME=${REDIS_USERNAME}
ENV REDIS_PASSWORD=${REDIS_PASSWORD}

ENTRYPOINT [ "java", "-jar", "spring.profiles.active=prod", "app.jar" ]